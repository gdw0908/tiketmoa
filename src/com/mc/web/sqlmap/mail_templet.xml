<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mail_templet">
	
	<select id="list" parameterType="Map" resultType="mcmap">
		SELECT PT1.* FROM (
			SELECT 
				TP_SEQ, TITLE, CONTS, TO_CHAR(REG_DT,'YYYY/MM/DD') AS REG_DT, REG_NM
				,ROW_NUMBER() OVER(ORDER BY TP_SEQ ASC) AS RN
			FROM 
				NSH_MAILING_TEMPLET
			WHERE 
				DEL_YN='N'
		<if test="!(keyword == null or keyword == '')" >
			AND ${condition} LIKE '%${keyword}%' 
		</if>
		) PT1
		WHERE CEIL(RN/NVL(#{rows, jdbcType=INTEGER},10))=NVL(#{cpage, jdbcType=INTEGER},1)
	</select>
		
	<select id="pageInfo" parameterType="Map" resultType="mcmap">
		SELECT 
			COUNT(1) AS TOTALCOUNT,
			CEIL(COUNT(1)/NVL(#{rows, jdbcType=INTEGER},10)) AS TOTALPAGE
		FROM NSH_MAILING_TEMPLET
		WHERE 
			DEL_YN='N'
		<if test="!(keyword == null or keyword == '')" >
			AND ${condition} LIKE '%${keyword}%' 
		</if>
	</select>
	
	<select id="article" parameterType="Map" resultType="mcmap">
		SELECT 
		  TP_SEQ, TITLE, CONTS, TO_CHAR(REG_DT,'YYYY/MM/DD') AS REG_DT, REG_NM, REG_SEQ
		FROM 
			NSH_MAILING_TEMPLET
		WHERE 
			TP_SEQ = #{tp_seq} 
		AND DEL_YN='N'
	</select>
	
	<insert id="regist" parameterType="Map">
			INSERT INTO NSH_MAILING_TEMPLET(
				TP_SEQ
				,TITLE
				,CONTS
				,REG_SEQ
				,REG_NM
			)VALUES(
			  	SEQ_NSH_MAILING_TEMPLET.nextval
			  	,#{title}
			  	,#{conts}
			  	,#{session_member_seq}
			  	,#{session_member_nm}
			)
	</insert>
	
	<update id="delete" parameterType="Map">
		UPDATE NSH_MAILING_TEMPLET SET 
			DEL_YN='Y'
			,DEL_SEQ=#{session_member_seq}
			,DEL_NM=#{session_member_nm}
			,DEL_DT=sysdate
		WHERE
			TP_SEQ in (${tp_seq}) 
	</update>
	
	<update id="modify" parameterType="Map">
		UPDATE NSH_MAILING_TEMPLET SET
			TITLE = #{title}
			,CONTS = #{conts}
			,MOD_DT = sysdate
			,MOD_SEQ = #{session_member_seq}
			,MOD_NM = #{session_member_nm}
		WHERE TP_SEQ = #{tp_seq}
	</update>
</mapper>