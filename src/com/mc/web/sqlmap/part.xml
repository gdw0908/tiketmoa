<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="part">
	
	<select id="cooperationList" parameterType="Map" resultType="mcmap">
        SELECT
            *
        FROM NSH_COOPERATION A
        WHERE A.DEL_YN='N'
	</select>
	
	<sql id="listWhere">
		WHERE a.DEL_YN='N'
		<if test='tab == "7"'><!-- 배터리 타이어 전장품 -->
			AND (
				(a.PART1 = '050901004' AND a.PART2 = '050901004012') or (a.PART1 = '050901003' AND a.PART2 = '050901003003') or a.PART1 = '050901006'
			)
		</if>
		<choose>
		<when test="(gubun == null or gubun == '')">
			AND a.GUBUN = '1'
		</when>
		<otherwise>
			AND a.GUBUN = #{gubun}
		</otherwise>
		</choose>
        <if test='client_yn == "Y"' ><!-- 사용자 페이지에서는 재고 없으면 안보여줌 -->
			AND a.STOCK_NUM > 0
			AND a.APPROVAL = 'Y'
			AND b.UUID IS NOT NULL
			AND DECODE(a.INQUIRY_YN, 'Y', 1, nvl(a.USER_PRICE, 0)) > 0
        </if>
        <if test="!(keyword == null or keyword == '')" >
        	AND (INSTR(lower(a.PRODUCTNM),lower(#{keyword})) > 0 
        	OR INSTR(lower(${condition}),lower(#{keyword})) > 0 
        	OR INSTR(lower(d.MAKERNM),lower(#{keyword})) > 0
        	OR INSTR(lower(f.CARMODELNM),lower(#{keyword})) > 0
        	OR INSTR(lower(f.CARMODELALIAS),lower(#{keyword})) > 0
        	OR INSTR(lower(a.PART_MAKER), lower(#{keyword})) > 0)
        </if>        
        <if test="!(nation == null or nation == '')" >
        	AND d.NATION = #{nation} 
        </if>
        <if test="!(carmakerseq == null or carmakerseq == '')" >
        	AND a.CARMAKERSEQ = #{carmakerseq} 
        </if>
        <if test="!(carmodelseq == null or carmodelseq == '')" >
        	AND a.CARMODELSEQ = #{carmodelseq} 
        </if>
        <if test="!(cargradeseq == null or cargradeseq == '')" >
        	AND a.CARGRADESEQ = #{cargradeseq} 
        </if>
        <if test="!(caryyyy == null or caryyyy == '')" >
        	AND a.CARYYYY = #{caryyyy} 
        </if>
        <if test="!(color == null or color == '')" >
        	AND a.COLOR = #{color} 
        </if>
        <if test="!(grade == null or grade == '')" >
        	AND a.GRADE = #{grade} 
        </if>
        <if test="!(com_seq == null or com_seq == '' or com_seq == 0)" >
        	AND a.COM_SEQ = #{com_seq} 
        </if>
        <if test="!(not_com_seq == null or not_com_seq == '' or not_com_seq == 0)" >
        	AND a.COM_SEQ &lt;&gt; #{not_com_seq} 
        </if>
        <if test="!(part1 == null or part1 == '')" >
        	AND a.PART1 = #{part1} 
        </if>
        <if test="!(part2 == null or part2 == '')" >
        	AND a.PART2 = #{part2} 
        </if>
         <if test="!(part2_1 == null or part2_1 == '')" >
        	AND a.PART2 in #{part2_1} 
        </if>
        <if test="!(part3 == null or part3 == '')" >
        	AND a.PART3 = #{part3} 
        </if>
        <if test="!(item_code == null or item_code == '')" >
        	AND a.ITEM_CODE = #{item_code} 
        </if>
        <if test="!(erp_code == null or erp_code == '')" >
        	AND a.ERP_CODE = #{erp_code} 
        </if>
        <choose>
        	<when test="approval_yn == 'N'.toString()">
        		AND (a.APPROVAL = #{approval_yn} or a.APPROVAL IS NULL)
        	</when>
	        <when test="!(approval_yn == null or approval_yn == '')" >
	        	AND a.APPROVAL = #{approval_yn} 
	        </when>
        </choose>
        <choose>
        	<when test='picture_yn=="Y"'>
        		AND b.UUID IS NOT NULL
        	</when>
        	<when test='picture_yn=="N"'>
        		AND b.UUID IS NULL
        	</when>
        </choose>
        <choose>
        	<when test='stock_yn=="Y"'>
        		AND a.STOCK_NUM > 0
        	</when>
        	<when test='stock_yn=="N"'>
        		AND a.STOCK_NUM = 0
        	</when>
        </choose>
        <choose>
        	<when test='acount_yn=="Y"'>
        		AND nvl(a.USER_PRICE, 0) > 0
        	</when>
        	<when test='acount_yn=="N"'>
        		AND nvl(a.USER_PRICE, 0) = 0
        	</when>
        </choose>
        <if test="search_all_text_arr != null and search_all_text_arr != ''">
			<foreach index="index" collection="search_all_text_arr">
				AND (
				lower(a.SEARCH_TAG) LIKE lower('%${search_all_text_arr[index]}%')
				OR lower(d.MAKERNM) LIKE lower('%${search_all_text_arr[index]}%')
				OR lower(a.PRODUCTNM) LIKE lower('%${search_all_text_arr[index]}%')
				OR lower(f.CARMODELNM) LIKE lower('%${search_all_text_arr[index]}%')
				OR lower(f.CARMODELALIAS) LIKE lower('%${search_all_text_arr[index]}%')
				OR a.ITEM_CODE = '${search_all_text_arr[index]}'
				OR lower(a.PART_MAKER) = lower('${search_all_text_arr[index]}')
        		<if test="!(search_all_text == null or search_all_text == '')" >
				OR lower(e.PARTNM) LIKE lower('%${search_all_text_arr[index]}%')
				OR lower(X.CODENM) LIKE lower('%${search_all_text_arr[index]}%')
				</if>
				)
			</foreach>
	 	</if>
        <if test="sdate != null and sdate != '' and edate != null and edate != ''" >
        	AND a.REG_DT BETWEEN TO_DATE(#{sdate} || '000000', 'YYYY-MM-DDHH24MISS') AND TO_DATE(#{edate} || '235959', 'YYYY-MM-DDHH24MISS')
        </if>
        <if test="!(session_member_id == null or session_member_id == '')" >
			AND	a.REG_ID = #{session_member_id}
		</if>
	</sql>
	
	<select id="list" parameterType="Map" resultType="mcmap">
		SELECT PT1.*, NVL(IS_LOCATION(CARPARTCODE), LOCATION) AS PART_LOCATION FROM (
			SELECT 
				PT_SUB.*,
                (SELECT CARGRADENM FROM V_IS_CARGRADE WHERE PT_SUB.CARGRADESEQ=CARGRADESEQ) AS CARGRADENM,
                (SELECT CODENM FROM V_IS_CODEMST WHERE PT_SUB.PART1=CODENO) AS PART1_NM,
                (SELECT CODENM FROM V_IS_CODEMST WHERE PT_SUB.PART2=CODENO) AS PART2_NM,
                NVL((SELECT PARTNM FROM V_IS_CARPART WHERE PT_SUB.PART3=CARPARTSEQ),PT_SUB.PRODUCTNM) AS PART3_NM,
                (SELECT CODE_NM FROM MC_COMMON_CODE WHERE CODE_GROUP_SEQ = '37' AND PT_SUB.COLOR=CODE) AS COLOR_NM,
                (SELECT DONG_NM FROM NSH_DONG WHERE PT_SUB.SIDO_CD=SIDO AND PT_SUB.SIGUNGU_CD=SIGUNGU AND DONG='000') as SIGUNGU_NM,
                ('/upload/board/'||PT_SUB.YYYY||'/'||PT_SUB.MM||'/'||PT_SUB.UUID||'_thumb') AS THUMB,
				<choose>
            		<when test="(sort == 'row')">
	                ROW_NUMBER() OVER(ORDER BY PT_SUB.INQUIRY_YN DESC,PT_SUB.USER_PRICE ASC,PT_SUB.ITEM_SEQ ASC) RN
            		</when>
            		<when test="(sort == 'high')">
	                ROW_NUMBER() OVER(ORDER BY PT_SUB.INQUIRY_YN ASC,PT_SUB.USER_PRICE DESC,PT_SUB.ITEM_SEQ DESC) RN
            		</when>
            		<otherwise>
                	ROW_NUMBER() OVER(ORDER BY PT_SUB.ITEM_SEQ DESC) RN
            		</otherwise>
            	</choose>
			FROM(
            SELECT
                a.ITEM_SEQ, a.GUBUN, a.ITEM_CODE, a.COM_SEQ, a.ERP_CODE, a.PRODUCTNM,a.CARYYYY, a.GRADE, NVL(a.USER_PRICE, 0) AS USER_PRICE, a.SUPPLIER_PRICE, a.SALE_PRICE, a.INQUIRY_YN,
                a.FEE_YN, a.BESTYN, a.EVENTYN, a.NEWYN, a.PUBLICYN, a.RECOMMYN, a.SALEYN, a.PLANYN, a.STOCK_NUM,
                a.CARMAKERSEQ, a.CARMODELSEQ, a.CARGRADESEQ, a.PART1, a.PART2, a.PART3, a.COLOR,
                a.REG_DT, g.CODE_NM,
                CASE
                WHEN a.SALE_SDATE &lt;= SYSDATE AND a.SALE_EDATE &gt; SYSDATE-1 THEN a.DISCOUNT_RATE
                ELSE 0
                END AS DISCOUNT_RATE,
                a.DISCOUNT_RATE AS DISCOUNT_RATE2, a.CARPARTCODE, a.PART_MAKER, a.LOCATION, 
                d.MAKERNM, f.CARMODELNM,
                a.APPROVAL, DECODE(a.APPROVAL, 'Y', '승인', '비승인') as APPROVAL_NM,
                b.ATTACH_NM,
                c.COM_NM, c.STAFF_TEL, c.SIDO_CD, c.SIGUNGU_CD,
                b.YYYY, b.MM, b.UUID
            FROM NSH_GOODS a LEFT OUTER JOIN NSH_ATTACH b
            ON b.TABLE_NM='NSH_GOODS' AND a.ITEM_SEQ = b.TABLE_SEQ AND b.ORDER_SEQ=1
            LEFT OUTER JOIN NSH_COOPERATION c
            ON a.COM_SEQ = c.SEQ
            LEFT OUTER JOIN V_IS_CARMAKER d ON a.CARMAKERSEQ=d.CARMAKERSEQ
            LEFT OUTER JOIN V_IS_CARMODEL f ON a.CARMODELSEQ=f.CARMODELSEQ
            LEFT OUTER JOIN MC_COMMON_CODE g ON a.COLOR=g.CODE
        	<if test="!(search_all_text == null or search_all_text == '')" >
        	LEFT OUTER JOIN V_IS_CODEMST X ON a.PART2=X.CODENO
            LEFT OUTER JOIN V_IS_CARPART e ON a.PART3=e.CARPARTSEQ
            </if>
			<include refid="listWhere"/>
			) PT_SUB
		) PT1
		WHERE RN BETWEEN NVL(#{rows, jdbcType=INTEGER},10) * (NVL(#{cpage, jdbcType=INTEGER},1) - 1) + 1 AND NVL(#{rows, jdbcType=INTEGER},10) * NVL(#{cpage, jdbcType=INTEGER},1)
		
		
			
	</select>
	
	<select id="pagination" parameterType="Map" resultType="mcmap">
		SELECT
			CEIL(COUNT(1)/NVL(#{rows}, 10)) TOTALPAGE,
			COUNT(1) TOTALCOUNT
        FROM NSH_GOODS a LEFT OUTER JOIN NSH_ATTACH b
            ON b.TABLE_NM='NSH_GOODS' AND a.ITEM_SEQ = b.TABLE_SEQ AND b.ORDER_SEQ=1
            LEFT OUTER JOIN NSH_COOPERATION c
            ON a.COM_SEQ= c.SEQ
            LEFT OUTER JOIN V_IS_CARMAKER d ON a.CARMAKERSEQ=d.CARMAKERSEQ
            LEFT OUTER JOIN V_IS_CARMODEL f ON a.CARMODELSEQ=f.CARMODELSEQ
            <if test="!(search_all_text == null or search_all_text == '')" >
        	LEFT OUTER JOIN V_IS_CODEMST X ON a.PART2=X.CODENO
            LEFT OUTER JOIN V_IS_CARPART e ON a.PART3=e.CARPARTSEQ            
            </if>
		<include refid="listWhere"/>
	</select>
	
	<select id="other_list" parameterType="Map" resultType="mcmap">
		SELECT PT1.* FROM (
            SELECT
                ROW_NUMBER() OVER(ORDER BY a.ITEM_SEQ DESC) RN,
                a.ITEM_SEQ, a.COM_SEQ, a.ERP_CODE, a.PRODUCTNM, a.CARYYYY, a.INQUIRY_YN,
                a.CARMAKERSEQ, a.CARMODELSEQ, a.CARGRADESEQ,
                a.REG_DT,
                SUBSTR(a.PART1,-1,1) AS MENU_CODE,
                (SELECT MAKERNM FROM V_IS_CARMAKER WHERE a.CARMAKERSEQ=CARMAKERSEQ) AS MAKERNM,
                (SELECT CARMODELNM FROM V_IS_CARMODEL WHERE a.CARMODELSEQ=CARMODELSEQ) AS CARMODELNM,
                (SELECT CARGRADENM FROM V_IS_CARGRADE WHERE a.CARGRADESEQ=CARGRADESEQ) AS CARGRADENM,
                (SELECT CODENM FROM V_IS_CODEMST WHERE a.PART1=CODENO) AS PART1_NM,
                (SELECT CODENM FROM V_IS_CODEMST WHERE a.PART2=CODENO) AS PART2_NM,
                NVL((SELECT PARTNM FROM V_IS_CARPART WHERE a.PART3=CARPARTSEQ),a.PRODUCTNM) AS PART3_NM,
                ('/upload/board/'||b.YYYY||'/'||b.MM||'/'||b.UUID||'_thumb') AS THUMB
            FROM NSH_GOODS a LEFT OUTER JOIN (
                SELECT
                    bb.*
                FROM (SELECT max(uuid) as uuid FROM NSH_ATTACH GROUP BY TABLE_NM, TABLE_SEQ) aa LEFT OUTER JOIN NSH_ATTACH bb
                ON aa.UUID = bb.UUID
            ) b
            ON b.TABLE_NM='NSH_GOODS' AND a.ITEM_SEQ = b.TABLE_SEQ
            LEFT OUTER JOIN NSH_COOPERATION c
            ON a.COM_SEQ = c.SEQ
            LEFT OUTER JOIN V_IS_CARMAKER d ON a.CARMAKERSEQ=d.CARMAKERSEQ
            WHERE a.COM_SEQ = (SELECT COM_SEQ FROM NSH_GOODS WHERE DEL_YN='N' AND ITEM_SEQ = #{seq})
            	AND a.DEL_YN='N'
				AND a.APPROVAL = 'Y'
				AND b.UUID IS NOT NULL
				AND a.INQUIRY_YN = 'N'
		) PT1
		WHERE CEIL(RN/NVL(#{rows},10))=NVL(#{cpage},1)
	</select>
	
	<select id="other_pagination" parameterType="Map" resultType="mcmap">
		SELECT
			CEIL(COUNT(1)/NVL(#{rows}, 10)) TOTALPAGE,
			COUNT(1) TOTALCOUNT
        FROM NSH_GOODS a LEFT OUTER JOIN (
                SELECT
                    bb.*
                FROM (SELECT max(uuid) as uuid FROM NSH_ATTACH GROUP BY TABLE_NM, TABLE_SEQ) aa LEFT OUTER JOIN NSH_ATTACH bb
                ON aa.UUID = bb.UUID
            ) b
        ON b.TABLE_NM='NSH_GOODS' AND a.ITEM_SEQ = b.TABLE_SEQ
        LEFT OUTER JOIN NSH_COOPERATION c
        ON a.COM_SEQ = c.SEQ
        LEFT OUTER JOIN V_IS_CARMAKER d
        ON a.CARMAKERSEQ=d.CARMAKERSEQ
        WHERE a.COM_SEQ = (SELECT COM_SEQ FROM NSH_GOODS WHERE DEL_YN='N' AND ITEM_SEQ = #{seq})
        	AND a.DEL_YN='N'
			AND a.APPROVAL = 'Y'
			AND b.UUID IS NOT NULL
	</select>
	
	<update id="modify" parameterType="Map">
		update NSH_GOODS set
			COM_SEQ = #{com_seq}
			, CARMAKERSEQ = #{carmakerseq} 
			, CARMODELSEQ = #{carmodelseq} 
			, CARGRADESEQ = #{cargradeseq} 
			, PRODUCTNM = #{productnm} 
			, CARYYYY = #{caryyyy} 
			, COLOR = #{color} 
			, GRADE = #{grade} 
			, PART1 = #{part1} 
			, PART2 = #{part2} 
			, PART3 = #{part3} 
			, USER_PRICING_YN = #{user_pricing_yn} 
			, USER_PRICE = #{user_price} 
			, SUPPLIER_PRICING_YN = #{supplier_pricing_yn} 
			, SUPPLIER_PRICE = #{supplier_price} 
			, SALE_PRICE = #{sale_price} 
			, SALE_SDATE = TO_DATE(#{sale_sdate}, 'yyyy-MM-dd') 
			, SALE_EDATE = TO_DATE(#{sale_edate}, 'yyyy-MM-dd') 
			, DISCOUNT_RATE = #{discount_rate} 
			, FEE_YN = #{fee_yn} 
			, FEE_AMOUNT = #{fee_amount} 
			, STOCK_YN = #{stock_yn} 
			, STOCK_NUM = #{stock_num} 
			, ERP_CODE = #{erp_code} 
			, COMMISSION = #{commission} 
			, SEARCH_TAG = #{search_tag} 
			, BESTYN = #{bestyn} 
			, EVENTYN = #{eventyn} 
			, NEWYN = #{newyn} 
			, PUBLICYN = #{publicyn} 
			, RECOMMYN = #{recommyn} 
			, SALEYN = #{saleyn} 
			, PLANYN = #{planyn} 
			, APPROVAL = #{approval} 
			, INQUIRY_YN = #{inquiry_yn} 
			, CAR_YN = #{car_yn} 
			, CONTS = #{conts}
			, PART_MAKER = #{part_maker}
			, LOCATION = #{location}
			, MOD_ID = #{session_member_id}
			, MOD_DT = sysdate
		WHERE ITEM_SEQ = #{item_seq}
	</update>
	
	<update id="write" parameterType="Map" useGeneratedKeys="true" keyColumn="item_seq" keyProperty="parent_seq">
		INSERT INTO NSH_GOODS(
			ITEM_SEQ, ITEM_CODE, GUBUN, COM_SEQ, CARMAKERSEQ, CARMODELSEQ, CARGRADESEQ, PRODUCTNM, CARYYYY, COLOR, GRADE, PART1, PART2, PART3, 
			USER_PRICING_YN, USER_PRICE, SUPPLIER_PRICING_YN, SUPPLIER_PRICE, SALE_PRICE, SALE_SDATE, SALE_EDATE, DISCOUNT_RATE, 
			FEE_YN, FEE_AMOUNT, STOCK_YN, STOCK_NUM, ERP_CODE, COMMISSION, SEARCH_TAG, BESTYN, EVENTYN, NEWYN, PUBLICYN, RECOMMYN, 
			SALEYN, PLANYN, APPROVAL, CONTS, INQUIRY_YN, CAR_YN, PART_MAKER, LOCATION,
			REG_ID, REG_DT
		)VALUES(
			SEQ_NSH_GOODS.NEXTVAL, 'P' || TO_CHAR(SYSDATE, 'YYMMDD') || to_char(10000000+SEQ_NSH_GOODS.nextval), #{gubun}, #{com_seq}, #{carmakerseq}, #{carmodelseq}, #{cargradeseq}, #{productnm}, #{caryyyy}, #{color}, #{grade}, #{part1}, #{part2}, #{part3}, 
			#{user_pricing_yn}, #{user_price}, #{supplier_pricing_yn}, #{supplier_price}, #{sale_price}, TO_DATE(#{sale_sdate}, 'yyyy-MM-dd'), TO_DATE(#{sale_edate}, 'yyyy-MM-dd'), #{discount_rate}, 
			#{fee_yn}, #{fee_amount}, #{stock_yn}, #{stock_num}, #{erp_code}, #{commission}, #{search_tag}, #{bestyn}, #{eventyn}, #{newyn}, #{publicyn}, #{recommyn}, 
			#{saleyn}, #{planyn}, #{approval}, #{conts}, #{inquiry_yn}, #{car_yn}, #{part_maker}, #{location},
			#{session_member_id}, SYSDATE
		)
	</update>
	
	<select id="view" parameterType="Map" resultType="mcmap">
		SELECT
            CASE
            WHEN a.SALE_SDATE &lt;= SYSDATE AND a.SALE_EDATE &gt; SYSDATE-1 THEN a.DISCOUNT_RATE
            ELSE 0
            END AS DISCOUNT_RATE,
            a.DISCOUNT_RATE AS DISCOUNT_RATE2,
            a.ITEM_SEQ, a.COM_SEQ, a.GUBUN, a.CARMAKERSEQ, a.CARMODELSEQ, a.CARGRADESEQ,
			a.PRODUCTNM, a.CARYYYY, a.COLOR, a.GRADE, a.PART1, a.PART2,
			a.PART3, a.USER_PRICING_YN, a.USER_PRICE, a.SUPPLIER_PRICING_YN,
			a.SUPPLIER_PRICE, a.SALE_PRICE, a.SALE_SDATE, a.SALE_EDATE, a.FEE_YN, a.FEE_AMOUNT, a.STOCK_YN,
			a.STOCK_NUM, a.ERP_CODE, a.COMMISSION, a.SEARCH_TAG, a.BESTYN, a.EVENTYN, a.NEWYN, a.PUBLICYN,
			a.RECOMMYN, a.SALEYN, a.PLANYN, a.APPROVAL, a.CONTS, a.REG_ID, a.REG_DT, a.MOD_ID, a.MOD_DT, a.DEL_ID,
			a.DEL_DT, a.DEL_YN, a.SERVICE, a.ITEM_CODE, a.CARSEQ, a.CARPARTCODE, a.INSUN_ITEMSEQ, a.INQUIRY_YN, a.CAR_YN,
			a.PART_MAKER, a.LOCATION,
            b.COM_NM, b.ADDR1, b.ADDR2, b.STAFF_NM, b.STAFF_NM2, b.STAFF_TEL, b.STAFF_TEL2, b.CEO_NM, b.SMS_TEL, b.TEL, b.FAX, b.TELESALES_NO, b.COMPTYP1, b.COMPTYP2, b.BUSI_NO,
            b.X_COORD, b.Y_COORD,
            TO_CHAR(b.REG_DT,'YYYY-MM-DD') REG_DATE,
            (SELECT MAKERNM FROM V_IS_CARMAKER WHERE a.CARMAKERSEQ=CARMAKERSEQ) AS MAKERNM,
            (SELECT CARMODELNM FROM V_IS_CARMODEL WHERE a.CARMODELSEQ=CARMODELSEQ) AS CARMODELNM,
            (SELECT CARGRADENM FROM V_IS_CARGRADE WHERE a.CARGRADESEQ=CARGRADESEQ) AS CARGRADENM,
            (SELECT CODENM FROM V_IS_CODEMST WHERE a.PART1=CODENO) AS PART1_NM,
            (SELECT CODENM FROM V_IS_CODEMST WHERE a.PART2=CODENO) AS PART2_NM,
            NVL((SELECT PARTNM FROM V_IS_CARPART WHERE a.PART3=CARPARTSEQ),a.PRODUCTNM) AS PART3_NM,
            (SELECT CODE_NM FROM MC_COMMON_CODE WHERE CODE_GROUP_SEQ = '37' AND a.COLOR=CODE) AS COLOR_NM
		FROM NSH_GOODS a LEFT OUTER JOIN NSH_COOPERATION b
        ON a.COM_SEQ = b.SEQ
		WHERE a.ITEM_SEQ = #{seq} 
	</select>
	
	<select id="photo" parameterType="Map" resultType="mcmap">
        SELECT
            ROW_NUMBER() OVER(ORDER BY b.ORDER_SEQ DESC) RN,
            b.*
        FROM NSH_GOODS a LEFT OUTER JOIN NSH_ATTACH b
        ON b.TABLE_NM='NSH_GOODS' 
            AND a.ITEM_SEQ = b.TABLE_SEQ
        WHERE a.ERP_CODE=#{erp_code}
	</select>
	
	<select id="photoList" parameterType="Map" resultType="mcmap">
        SELECT
            ROW_NUMBER() OVER(ORDER BY b.ORDER_SEQ DESC) RN,
            b.*
        FROM NSH_GOODS a JOIN NSH_ATTACH b
        ON b.TABLE_NM='NSH_GOODS' 
            AND a.ITEM_SEQ = b.TABLE_SEQ
        WHERE a.ITEM_SEQ=#{item_seq}
	</select>
	
	<update id="del" parameterType="Map">
		UPDATE NSH_GOODS SET
			DEL_YN = 'Y'
			,DEL_ID = #{session_member_id}
			,DEL_DT = sysdate
		WHERE ITEM_SEQ = #{item_seq}
	</update>
	
</mapper>